# Basic EDA for case study B
## Telco


```{r, echo=FALSE, include=FALSE}
library(tidyverse)
library(readxl)
library(ggpubr)
library(corrr)
library(GGally)
library(dplyr)
```


Updated EDA with Vivian's model
```{r}
# Add the new column (clusters_hc1 already in env)
#telco$group = clusters_hc1 
#head(telco) #yikes 25 cols
#write.csv(telco, file="grouped_telco.csv")

telco <- read.csv("grouped_telco.csv")

telco$group <- as.factor(telco$group)
str(telco)
```

```{r}
# Sanity check
summary(telco)
telco[1,]
telco[, ncol(telco)]
str(telco)
```

Cols:       
1-2: basic customer info        
3-19: call data (duration)      
20-24: tariff schemes (cost)        

All variables are numeric.

```{r, echo=FALSE, include=FALSE}
telco[!complete.cases(telco),]

#Drop first index column
telco <- subset(telco, select=-c(X))
str(telco)
```
We have no NAs.

### Overall

```{r}
pairs_tot <- ggpairs(telco, aes(color = group, alpha = 0.4))
pairs_tot
```

Can't see anything!

```{r}
pairs1_2 <- ggpairs(telco[, c(1:2, 25)], aes(color = group, alpha = 0.4))
pairs1_2
```

`Age` is not so special. No correlation. `L_O_S` is bimodal, 2 groups ?

```{r}
#It's quite slow..
pairs3_19 <- ggpairs(telco[, c(3:19, 25)], aes(color = group, alpha = 0.4))
pairs3_19
```

`Nat_call_cost_Sum`, `National_mins`, `All_calls_mins` -> multinomial distrib?

`Peak_mins_Sum` together with `Nat_call_cost_Sum` -> 2 clusters

```{r}
pairs20_24 <- ggpairs(telco[, 20:25], aes(color = group, alpha = 0.4))
pairs20_24
```

All variables multinomial, tariffs grouping?

Let's explore a subset of the interesting variables:

```{r}
subset <- telco[, c(1:2, 5, 11, 16, 18, 20:25)]
pairs_sub <- ggpairs(subset, aes(color = group, alpha = 0.4))
pairs_sub
```

### Misc

A few subsets to use.

```{r}
sub1_2 <- telco[, c(1:2, 25)]
sub3_19 <- telco[, c(3:19, 25)]
sub20_24 <- telco[, c(20:25)]

# From the model (only the interesting variables)
#names <- as.vector(colnames(data_norm))
#names[12] <- "actual.call.cost"
submodel <- telco %>% select(all_of(names))
```

The interesting variables from Vivian's model are:


## Groups comparison

### Histograms

```{r}
hist_col <- function (data, column) {
    ggplot(data = data, aes_string(x = column, color = data$group)) +
    geom_freqpoly(binwidth = 30) + xlab(column) +
    ggsave(paste("figures/hist/hist_", column, ".png"))
}
```

```{r}
histograms <- lapply(colnames(telco), hist_col, data = telco)

histograms
```


### Boxplots

```{r}
box_col <- function (data, column) {
    ggplot(data = data, aes_string(x = column, y = data$group)) +
    geom_boxplot(mapping = aes(color = group)) + xlab(column) + ylab("groups") +
    ggsave(paste("figures/boxplots/bxplt_", column, ".png"))
}
```

```{r}
boxplots <- lapply(colnames(telco), box_col, data = telco)

boxplots
```

## Groupwise EDA

### 1.







## Old
EDA V1
### Basic customer info
```{r}
summary(telco[, 1:2])
boxplot(telco[, 1:2])

ggplot(data=telco) + 
    geom_histogram(mapping = aes(x = Age, color=group), binwidth = 1) +
    ggsave("figures/Age_hist.png")

ggplot(data=telco) + 
    geom_histogram(mapping = aes(x = L_O_S), binwidth = .8) +
    ggsave("figures/L_O_S_hist.png")

#The outlier
telco[which(telco$Age==82),]
```

Just one outlier for `Age`. 

```{r, echo=FALSE}
telco_cor <- telco %>%
    correlate() %>%
    rearrange(method = "MDS", absolute = FALSE) %>%
    shave() 
telco_cor

telco_cor_plot <- telco_cor %>%
    rplot(shape = 19, colors = c("red", "green")) +
    theme(axis.text.x = element_text(angle = 90))  +
  ggsave("figures/corrplot.png")
telco_cor_plot
```





